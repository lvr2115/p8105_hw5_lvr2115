---
title: "p8105_hw5_lvr2115"
author: "Laura Robles-Torres"
date: "2023-11-13"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggplot2)
library(rvest)
```

 
## Problem 2

Import and tidy data

```{r import and tidy,message=FALSE,warning=FALSE}

raw_data = 
  tibble(
    files = list.files("./data"),
    path = str_c("./data/", files)
  ) |>
  mutate(data = map(path, read_csv)) |>
  unnest(data) 

tidy_data =
  raw_data |> 
   janitor::clean_names() |> 
   separate(files, sep="_", into = c("study_arm", "subject_id")) |>
   separate(subject_id, sep=".csv", into=c("subject_id")) |>
   mutate(study_arm = recode(study_arm, "con" = "Control", "exp" = "Experiment")) |>
   pivot_longer(
    cols = starts_with("week"),
    names_prefix = "week_",
    names_to = "week_num",
    values_to = "obs"
  ) |>
  mutate(
     week_num = as.numeric(week_num)) |>
  select(study_arm, subject_id, week_num, obs)
```

This spaghetti plot shows observations on each subject in the control and the experimental group over time. This plot shows that the experimental group's observed values increased as the study progressed from week 1 to week 8, showing a positive association between observed value and time. The control group's observed values range do not show this trend. The control group's observed values on week 8 are all lower than the experimental group's observed values on the same week. 

```{r plot}
ggplot(tidy_data, aes(x = week_num, y = obs , color = subject_id)) + 
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ study_arm) +
  labs(
    x = "Week", 
    y = "Observed value",
    title = "Changes in observed value per study arm over time",
    color = "Subject ID"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

## Problem 3


```{r}
# T-test function
sim_ttest = function(n=30, mu=0, sigma=5) {
  
  ttest_data = tibble(
    x=rnorm(n,mean=mu,sd=sigma),
  )

  ttest_data |>
    t.test(alpha=0.05) |>
    broom::tidy() |>
    select(estimate, p.value)
}
```

#testing 5000 samples with mean = 0 
```{r}
output = vector("list", 5000) 
#output: a list of 5000 values
for (i in 1:500) {
  output[[i]] = sim_ttest(mu=0) 
  #for loop: for each index in 1 to 100, im gonna have my output i = the simttest of mu=0
}

sim_result = bind_rows(output)
```

#simulation mu {1 thru 6}
```{r}
sim_results_df=
  expand_grid(
    mu_size=c(1,2,3,4,5,6),
    iter=1:5000
  ) |>
  mutate(
    estimate_df = map(mu_size, sim_ttest)) |>
  unnest(estimate_df)

print(estimate_df)
```

